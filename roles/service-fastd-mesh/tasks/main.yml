---
- name: install fastd packages
  apt:
    name: fastd
    state: present

- name: create fastd directories
  file:
    path: "/etc/fastd/{{ item.key }}VPN"
    state: directory
    mode: 0755
  with_dict: "{{ meshes }}"

- name: template fastd mesh config
  template:
    src: fastd-mesh.conf.j2
    dest: "/etc/fastd/{{ item.key }}VPN/fastd.conf"
  with_dict: "{{ meshes }}"

- name: write fastd mesh secret
  template:
    src: fastd-secret.conf.j2
    dest: "/etc/fastd/{{ item.key }}VPN/secret.conf"
  with_dict: "{{ meshes }}"
