---
- name: install nftables packages
  package:
    name: "{{ item }}"
    state: present
  loop:
    - nftables

- name: set netfilter sysctl settings
  sysctl:
    name: "{{ item.name }}"
    value: "{{ item.value }}"
    state: present
  loop: "{{ sysctl_settings_netfilter }}"

- name: write netfilter configuration
  template:
    src: nftables.conf
    dest: /etc/nftables.conf
  notify: nftables restart

- name: enable and start nftables
  systemd_service:
    state: started
    daemon_reload: true
    enabled: yes
    name: nftables
