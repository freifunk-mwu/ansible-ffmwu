#
# {{ ansible_managed }}
#
server {
    listen 80;
    listen [::]:80;
    server_name {{ mailman3_site_domain }};

    include /etc/nginx/snippets/redirect-to-ssl.conf;
}

server {
      listen 443 ssl http2;
      keepalive_timeout 70;

      server_name {{ mailman3_site_domain }};

      access_log  /var/log/nginx/mailman.access.log;
      error_log /var/log/nginx/mailman.error.log;

      ssl_certificate     /etc/nginx/ssl/{{ inventory_hostname }}/fullchain.pem;
      ssl_certificate_key /etc/nginx/ssl/{{ inventory_hostname }}/privkey.pem;

      location /static/ {
              alias {{ mailman3_django_project_static_dir }}/;
      }

      location / {
              include uwsgi_params;
              uwsgi_pass 127.0.0.1:8000;
      }
}
